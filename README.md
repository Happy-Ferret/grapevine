# Gossip

Gossip is a MUD chat network.

## Requirements

- PostgreSQL 10
- Elixir 1.6
- Erlang 20
- node.js 8.6

## Setup

```bash
mix deps.get
mix compile
cd assets && npm install && node node_modules/brunch/bin/brunch build && cd ..
mix ecto.reset
mix run --no-halt
```

This will start a web server on port 4000. You can now load [http://localhost:4000/](http://localhost:4000/) to view the application.

## Running Tests

```bash
MIX_ENV=test mix ecto.create
MIX_ENV=test mix ecto.migrate
mix test
```
## WebSocket Protocol

### Sign-in

After connecting to the websocket, you must authenticate before performing any other actions. Send your Client ID and Client secret as part of this event to authenticate the connection.

```json
{
  "event": "authenticate",
  "payload": {
    "client_id": "client id",
    "client_secret": "client secret",
    "user_agent": "ExVenture 0.23.0"
  }
}
```

### Post a New Message

To post a new message to a channel, send this event to the server:

```json
{
  "event": "messages/new",
  "payload": {
    "channel": "gossip",
    "name": "Player",
    "message": "Hello everyone!"
  }
}
```

### Receive a Broadcast

When a channel you are subscribed to receives a new message, you will get a broadcast event. The ID is a UUID generated by the server to better track if you've previously seen a message or not.

```json
{
  "event": "messages/broadcast",
  "payload": {
    "id": "0ce4e854-72d5-4ebe-91f4-055b9595147b",
    "channel": "gossip",
    "message": "Hello everyone!",
    "game": "ExVenture",
    "name": "Player"
  }
}
```

### Receive subscribed channels

After authenticating, the server will send the channels you are subscribed to. These are configurable on via the Gossip website on the config page.

```json
{
  "event": "channels/subscribed",
  "payload": {
    "channels": ["gossip"]
  }
}
```

### Heartbeat

Server sends a heartbeat every ~15 seconds to keep the connection alive.

```json
{
  "event": "heartbeat"
}
```
